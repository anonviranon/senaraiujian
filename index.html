<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <title>Senarai Ujian Hospital Baling</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'component-bg': '#F0F7FF', // A very light blue for components
                    },
                    boxShadow: {
                        'neumorphic': '9px 9px 16px #d5dde6, -9px -9px 16px #ffffff',
                        'neumorphic-inset': 'inset 9px 9px 16px #d5dde6, inset -9px -9px 16px #ffffff',
                        'neumorphic-button': '5px 5px 10px #d5dde6, -5px -5px 10px #ffffff',
                        'neumorphic-button-pressed': 'inset 5px 5px 10px #d5dde6, inset -5px -5px 10px #ffffff',
                    }
                },
            },
        }
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 font-sans">

    <div class="container mx-auto p-4">
        <!-- Header Section -->
        <header class="bg-component-bg rounded-lg shadow-neumorphic p-6 mb-8 flex flex-col sm:flex-row items-center justify-between">
            <div class="flex items-center mb-4 sm:mb-0">
                <img src="https://i.imgur.com/SBAttec.png" alt="LOGO HOSPITAL" class="h-12 mr-4">
                <h1 class="text-2xl font-bold text-gray-700 text-center sm:text-left">Senarai Ujian Hospital Baling</h1>
            </div>
            <a href="https://docs.google.com/spreadsheets/d/1wbIt_KVFfIfqmB6-QR3Fk7zT5tY7lV_EzmqXaWgBY04/export?format=xlsx" 
               class="bg-component-bg text-gray-700 font-bold py-3 px-6 rounded-lg shadow-neumorphic-button active:shadow-neumorphic-button-pressed transition-shadow duration-150" 
               download>
                Muat Turun Senarai Ujian
            </a>
        </header>

        <!-- Search Input -->
        <div class="mb-8">
            <input type="text" id="searchBox" placeholder="Taip untuk cari ujian..." class="w-full p-4 bg-component-bg border-none rounded-lg shadow-neumorphic-inset focus:outline-none text-center text-gray-700">
        </div>

        <!-- Table Container -->
        <div class="overflow-auto max-h-[75vh] bg-white rounded-lg shadow-neumorphic p-2">
            <table id="dataTable" class="w-full table-auto">
                <thead class="sticky top-0 z-10">
                    <tr class="bg-gray-800">
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider rounded-tl-lg">Ujian</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Status</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Permohonan</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Borang</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Spesimen</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Bekas</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Isipadu</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Panduan untuk Ward dan Klinik</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Panduan untuk Staf Makmal</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Jadual Ujian</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">TAT</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Pusat Ujian</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider">Makmal</th>
                        <th class="px-2 py-3 text-center text-xs font-medium text-white uppercase tracking-wider rounded-tr-lg">Keputusan</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="bg-white">
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const sheetId = '1wbIt_KVFfIfqmB6-QR3Fk7zT5tY7lV_EzmqXaWgBY04';
        const sheetGid = '0';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&gid=${sheetGid}`;

        // Fetch and display data on window load
        window.onload = function() {
            fetchData();
        };

        // Add event listener for the search box
        document.getElementById('searchBox').addEventListener('keyup', filterTable);

        /**
         * Fetches and parses data from the Google Sheet.
         */
        function fetchData() {
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split(/\r?\n(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/);
                    const parsedData = rows.slice(1).map(row => {
                        if (!row) return [];
                        const columns = row.match(/("[\s\S]*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                        return columns.map(cell => {
                            let cleanCell = cell.trim();
                            if (cleanCell.startsWith('"') && cleanCell.endsWith('"')) {
                                cleanCell = cleanCell.slice(1, -1);
                            }
                            return cleanCell.replace(/""/g, '"');
                        });
                    });
                    displayData(parsedData);
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        /**
         * Checks if a string is a valid URL.
         */
        function isValidUrl(str) {
            const pattern = new RegExp('^(https?:\\/\\/)?' + '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + '((\\d{1,3}\\.){3}\\d{1,3}))' + '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + '(\\?[;&a-z\\d%_.~+=-]*)?' + '(\\#[-a-z\\d_]*)?$', 'i');
            return !!pattern.test(str);
        }

        /**
         * Displays the fetched data in the table.
         */
        function displayData(data) {
            const tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = "";
            const columnCount = 14;

            data.forEach((row) => {
                if (!Array.isArray(row) || row.every(cell => !cell || cell.trim() === '')) {
                    return;
                }
                
                const rowElement = document.createElement("tr");
                rowElement.className = "border-b border-gray-300";

                for (let i = 0; i < columnCount; i++) {
                    const cell = row[i] || '';
                    const cellElement = document.createElement("td");
                    cellElement.className = "px-2 py-4 text-sm text-gray-700 text-center break-words";
                    
                    const cellText = cell.trim();

                    if (cellText.toUpperCase() === "ACTIVE") {
                        cellElement.innerText = cellText;
                        cellElement.className += " text-green-500 font-semibold";
                    } else if (cellText.toUpperCase() === "SUSPENDED") {
                        cellElement.innerText = cellText;
                        cellElement.className += " text-red-500 font-semibold";
                    } else if (isValidUrl(cellText)) {
                        const anchor = document.createElement("a");
                        anchor.href = cellText.startsWith('http') ? cellText : `http://${cellText}`;
                        anchor.target = "_blank";
                        anchor.className = "text-blue-600 hover:underline";
                        
                        if (cellText.includes("10.159.102.72/Home/Order/Req") || cellText.includes("10.159.102.72/Home/Result")) {
                            anchor.innerText = "i-Report AG Hospital Baling";
                        } else if (cellText.includes("10.159.96.131/iReportAG/Home/Result")) {
                            anchor.innerText = "i-ReportAG Hospital Kulim";
                        } else {
                            anchor.innerText = "Klik untuk Borang Permohonan Ujian";
                        }
                        cellElement.appendChild(anchor);
                    } else {
                        cellElement.innerText = cellText;
                    }
                     if (i === 7) {
                        cellElement.classList.add('text-red-600', 'font-medium');
                    }

                    rowElement.appendChild(cellElement);
                }

                tableBody.appendChild(rowElement);
            });
        }

        /**
         * Filters the table based on the search input.
         */
        function filterTable() {
            const filter = document.getElementById("searchBox").value.toLowerCase();
            const rows = document.querySelectorAll("#dataTable tbody tr");

            rows.forEach((row) => {
                const cells = row.querySelectorAll("td");
                let match = false;
                cells.forEach((cell) => {
                    if (cell.textContent.toLowerCase().includes(filter)) {
                        match = true;
                    }
                });
                row.style.display = match ? "" : "none";
            });
        }
    </script>
</body>
</html>


